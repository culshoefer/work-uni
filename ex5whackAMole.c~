#include "ex5.h"
#include "queue.h"

bool seen[65536];
unsigned short parent[65536];
char hitPosition[65536];
bool conf[65536][16];
//short chainLength[65536];
void printConf(bool a[16]);


int main(void){
  FILE *fp = fopen("input.txt","r");

  qBack = (queueElement **)malloc(sizeof(queueElement **));
  qFront = (queueElement **)malloc(sizeof(queueElement **));

  (*qBack) = NULL;
  (*qFront)= NULL;

  int nextInt;
  bool currentAr[16];
  int i, j, temp = 0;
  bool found = false;
  unsigned short current = 1;
  unsigned short first;

  nextInt=readNextInt(fp);
  while(nextInt != 0){
    currentAr[nextInt-1] = true;
    nextInt = readNextInt(fp);
  }
  first=boolToShort(currentAr);
  for (i=0; i<16; i++) *(currentAr + i) = false;
  parent[first] = first;
  hitPosition[first] = 0;
  for(i=0; i<16;i++)
    conf[first][i] = currentAr[i];

  enqueue(first);
  while (!found){
    current = dequeue();
    seen[current]=true;
    found=true;
    for (i = 0; i < 16; i++){
      bool  new[16];
      if (conf[current][i])
      {
	found=false;
	getNextConf(i, conf[current], &new);
	unsigned short newVal=0;
	newVal = boolToShort(new);
	if (!(seen[newVal]))
	{
	  //	  printf("queuing %d\n", newVal);
	  parent[newVal] = current;
	  hitPosition[newVal] = i;
	  for (j = 0; j < 16; j++) 
	    conf[newVal][j]  = new[j];
	  enqueue(newVal);
	  //	  printf("qBack: %p\n", (*qBack));
	  //	  printf("qFront: %p\n", (*qFront) -> next -> num);
	}
      }
    }
  }
  while(current != first){
    printf("%d\t",hitPosition[current]+1);
    current = parent[current];
    }
  printf("\n");
//  scanf("%d", &i);
  fclose(fp);
  return 0;
}


void getNextConf(char hit, bool current[16], bool (*new)[16]){
  int i;
  //printf("HITING AT %d\n", hit);
  for(i = 0; i < 16; i++) 
    (*new)[i] = current[i];
  (*new)[hit] = !((*new)[hit]);
  if(hit >= 4)
    (*new)[hit - 4]= !((*new)[hit - 4]);
  if(hit <= 11)
    (*new)[hit + 4]= !((*new)[hit + 4]);
  if(hit % 4 != 0)
    (*new)[hit - 1]= !((*new)[hit - 1]);
  if(hit % 4 != 3)
    (*new)[hit + 1]= !((*new)[hit + 1]);

  //  printConf(*new);
}

unsigned short boolToShort(bool a[16]){
  unsigned short retval=0;
  int i;
  for(i=15; i>=0; i--){
    if(a[i])
      retval++;
    retval*=2;
  }
  return retval;
}

void printConf(bool a[16]){
  int i;
  printf("\n");
  for (i=0; i<16; i++){
    if(a[i] == 1)
      printf("%d\t", i);
  }
  printf("\n");
  for (i=0; i<16; i++){
    if (a[i] == 1)
      printf("1");
    else
      printf("0");
    if (i%4 == 3)
      printf("\n");
  }
  printf("\n");
}

